<section class="panel">
  <div class="head"><button class="back" onclick="history.back()">â†</button><div class="title">ğŸŒ€ Profilo</div></div>

  <div class="section">
    <h3>ğŸ’ Piani & Upgrade</h3>
    <div class="grid3" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
      <button class="btn plan" data-plan="buds">ğŸŒ± Boccioli<br><small>â‚¬7,99/m</small></button>
      <button class="btn plan" data-plan="flowers">ğŸŒ¸ Fiori<br><small>â‚¬12,99/m</small></button>
      <button class="btn plan" data-plan="premium">ğŸ’ Premium<br><small>â‚¬149,99/m</small></button>
    </div>
    <div class="small" style="margin-top:8px">Checkout Stripe (test). Dopo il pagamento torni qui.</div>
  </div>

  <div class="section">
    <h3>ğŸ“Š Dashboard personale</h3>
    <div class="row"><span>Tempo meditazione:</span><strong id="stat-med">0</strong> min</div>
    <div class="row"><span>Allenamenti:</span><strong id="stat-wo">0</strong></div>
    <div class="row"><span>Giorni di journaling:</span><strong id="stat-jr">0</strong></div>
  </div>
</section>

<script>
document.querySelectorAll('.plan').forEach(b=>{
  b.onclick = async ()=>{
    const plan=b.dataset.plan;
    const r = await fetch('/api/checkout', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        plan,
        success_url: location.origin+'/#/profile?success=1',
        cancel_url: location.href
      })
    });
    const {url,error} = await r.json();
    if(error) return alert(error);
    location.href = url;
  };
});

// statistiche (pull da localStorage come esempio)
document.getElementById('stat-wo').textContent = (JSON.parse(localStorage.getItem('mf_fit_workouts')||'[]')||[]).length;
document.getElementById('stat-jr').textContent = (JSON.parse(localStorage.getItem('mf_emotions_journal')||'[]')||[]).length;
</script>
