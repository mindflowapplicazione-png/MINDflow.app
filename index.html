<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mèlora 🌙</title>
  <style>
    body { background:#000; color:#fff; font-family:Arial, sans-serif; margin:0; padding:0; }
    header { text-align:center; padding:20px; font-size:1.5em; background:#111; }
    main { padding:15px; }
    section { border:1px solid #333; padding:15px; border-radius:8px; margin-bottom:20px; }
    h2 { margin-top:0; }
    input, textarea, button, select {
      width:100%; padding:8px; margin:5px 0; border-radius:6px; border:none;
    }
    button { background:#e91e63; color:white; font-weight:bold; cursor:pointer; }
    button:hover { background:#ad1457; }
    .output { white-space:pre-wrap; background:#111; padding:10px; border-radius:6px; margin-top:10px; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  </style>
</head>
<body>
  <header>🌸 Benvenuta in <b>Mèlora</b></header>
  <main>
    
    <!-- Chat motivazionale -->
    <section>
      <h2>🩷 Chat Motivazionale</h2>
      <textarea id="chatInput" placeholder="Scrivi un pensiero..."></textarea>
      <button onclick="sendChat()">Invia</button>
      <div id="chatOut" class="output"></div>
    </section>

    <!-- Ricette -->
    <section>
      <h2>🍽️ Ricette</h2>
      <input id="recIn" placeholder="Ingredienti (es: pollo, zucchine)">
      <button onclick="sendRecipes()">Genera ricette</button>
      <div id="recOut" class="output"></div>
    </section>

    <!-- Workout -->
    <section>
      <h2>💪 Workout</h2>
      <select id="goal">
        <option>Forza</option>
        <option>Dimagrimento</option>
        <option>Mobilità</option>
      </select>
      <input id="days" type="number" value="3" min="1" max="7">
      <button onclick="sendWorkout()">Crea piano</button>
      <div id="workOut" class="output"></div>
    </section>

    <!-- Astrologia -->
    <section>
      <h2>🔮 Astrologia</h2>
      <input id="date" type="date">
      <input id="time" type="time">
      <input id="place" placeholder="Luogo di nascita">
      <button onclick="sendAstro()">Leggi</button>
      <div id="astroOut" class="output"></div>
    </section>

    <!-- Feed -->
    <section>
      <h2>📢 Feed</h2>
      <textarea id="feedText" placeholder="Scrivi un post..."></textarea>
      <input id="feedFile" type="file">
      <button onclick="sendFeed()">Pubblica</button>
      <div id="feedOut" class="output"></div>
    </section>

    <!-- Emozioni -->
    <section>
      <h2>🩷 Emozioni</h2>
      <div class="grid">
        <input id="emoEmoji" placeholder="Emoji 😊">
        <input id="emoInt" type="number" placeholder="Intensità 1-10">
      </div>
      <input id="emoTrigger" placeholder="Trigger">
      <textarea id="emoWhy" placeholder="Perché?"></textarea>
      <textarea id="emoCare" placeholder="Self-care"></textarea>
      <input id="emoFile" type="file">
      <button onclick="sendMood()">Salva Emozione</button>
      <div id="emoOut" class="output"></div>
    </section>

    <!-- Planner -->
    <section>
      <h2>📅 Planner</h2>
      <input id="planStart" type="datetime-local">
      <input id="planEnd" type="datetime-local">
      <input id="planTitle" placeholder="Titolo attività">
      <button onclick="sendPlan()">Aggiungi</button>
      <div id="planOut" class="output"></div>
    </section>

    <!-- Bilancio -->
    <section>
      <h2>💸 Bilancio</h2>
      <select id="cashKind"><option value="in">Entrata</option><option value="out">Uscita</option></select>
      <input id="cashAmt" type="number" placeholder="Importo €">
      <input id="cashDesc" placeholder="Descrizione">
      <button onclick="sendCash()">Registra</button>
      <div id="cashOut" class="output"></div>
    </section>

  </main>

<script>
async function api(path, body) {
  const r = await fetch(path, { method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(body) });
  return r.json();
}

// CHAT
async function sendChat(){
  const message=document.getElementById("chatInput").value;
  const out=document.getElementById("chatOut");
  out.textContent="⏳...";
  const res=await api("/api/chat",{message});
  out.textContent=res.reply;
}

// RICETTE
async function sendRecipes(){
  const ingredients=document.getElementById("recIn").value;
  const out=document.getElementById("recOut");
  out.textContent="⏳...";
  const res=await api("/api/recipes",{ingredients});
  out.textContent=res.text;
}

// WORKOUT
async function sendWorkout(){
  const goal=document.getElementById("goal").value;
  const days=document.getElementById("days").value;
  const out=document.getElementById("workOut");
  out.textContent="⏳...";
  const res=await api("/api/workout",{goal,days});
  out.textContent=res.text;
}

// ASTRO
async function sendAstro(){
  const date=document.getElementById("date").value;
  const time=document.getElementById("time").value;
  const place=document.getElementById("place").value;
  const out=document.getElementById("astroOut");
  out.textContent="⏳...";
  const res=await api("/api/astro",{date,time,place});
  out.textContent=res.text;
}

// FEED
async function sendFeed(){
  const text=document.getElementById("feedText").value;
  const file=document.getElementById("feedFile").files[0];
  const out=document.getElementById("feedOut");
  out.textContent="⏳...";
  let media_urls=[];
  if(file){
    const b64=await toBase64(file);
    const up=await fetch("/api/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:file.name,dataBase64:b64,text,type:"feed"})});
    const u=await up.json();
    media_urls=[u.url];
  }
  const res=await api("/api/feed",{text,media_urls});
  out.textContent="✅ Post pubblicato";
}

// MOODS
async function sendMood(){
  const emoji=document.getElementById("emoEmoji").value;
  const intensity=document.getElementById("emoInt").value;
  const trigger=document.getElementById("emoTrigger").value;
  const why=document.getElementById("emoWhy").value;
  const selfcare=document.getElementById("emoCare").value;
  const file=document.getElementById("emoFile").files[0];
  const out=document.getElementById("emoOut");
  out.textContent="⏳...";
  let media_urls=[];
  if(file){
    const b64=await toBase64(file);
    const up=await fetch("/api/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:file.name,dataBase64:b64,type:"mood"})});
    const u=await up.json();
    media_urls=[u.url];
  }
  const res=await api("/api/moods",{emoji,intensity,trigger,why,selfcare,media_urls});
  out.textContent="✅ Emozione salvata";
}

// PLANNER
async function sendPlan(){
  const start_ts=document.getElementById("planStart").value;
  const end_ts=document.getElementById("planEnd").value;
  const title=document.getElementById("planTitle").value;
  const out=document.getElementById("planOut");
  out.textContent="⏳...";
  const res=await api("/api/planner",{start_ts,end_ts,title});
  out.textContent="✅ Attività salvata";
}

// CASHBOOK
async function sendCash(){
  const kind=document.getElementById("cashKind").value;
  const amount=document.getElementById("cashAmt").value;
  const description=document.getElementById("cashDesc").value;
  const out=document.getElementById("cashOut");
  out.textContent="⏳...";
  const res=await api("/api/cashbook",{kind,amount,description});
  out.textContent="✅ Registrato";
}

// Helper
function toBase64(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.readAsDataURL(file);
    r.onload=()=>resolve(r.result);
    r.onerror=reject;
  });
}
</script>
</body>
</html>
