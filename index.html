<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>MINDflow ‚Äì App</title>
<style>
:root{
  --bg:#000; --text:#fff; --dim:#cfcfd2;
  --panel:rgba(255,255,255,.05); --panel2:rgba(255,255,255,.1); --bd:rgba(255,255,255,.12);
  --p1:#FFB6C1; --p2:#FFDAB9; --p3:#9370DB;
  --shadow:0 6px 24px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:#000;color:#fff;font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden}
.app{height:100%;max-width:390px;margin:0 auto;display:flex;flex-direction:column;border:1px solid #222;border-radius:25px;background:rgba(0,0,0,.95);backdrop-filter:blur(10px);overflow:hidden}
.topbar{padding:18px 16px;text-align:center;border-bottom:1px solid #222;background:linear-gradient(135deg,#000,#1a1a1a)}
.logo{font-size:28px;font-weight:800;background:linear-gradient(45deg,var(--p1),var(--p2),var(--p1));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
.tag{font-size:12px;color:#9aa;font-style:italic;margin-top:4px}
main{flex:1;overflow:auto;padding:18px 16px 120px}

/* HOME 2x? centrata */
.home-wrap{height:100%;display:grid;place-items:center}
.home{
  display:grid; grid-template-columns:repeat(2,150px); grid-auto-rows:150px; gap:16px;
  place-content:center; place-items:center;
}
.card{
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;
  width:150px; height:150px; border-radius:16px; border:1px solid var(--bd);
  color:#fff; text-align:center; cursor:pointer; transition:transform .18s ease; box-shadow:var(--shadow)
}
.card:focus-visible{outline:2px solid var(--p1); outline-offset:2px}
.ic{font-size:28px}.tl{font-weight:700}.st{font-size:11px;opacity:.8}
.career{background:linear-gradient(135deg,#1a1a2e,#16213e)}
.emo{background:linear-gradient(135deg,#2d1b2e,#3e2640)}
.fit{background:linear-gradient(135deg,#2e1f1a,#3e2a1b)}
.spi{background:linear-gradient(135deg,#1a2e1f,#1b3e26)}
.com{background:linear-gradient(135deg,#2e2a1a,#3e361b)}
.pro{background:linear-gradient(135deg,#2e1a2a,#3e1b2f)}

.view{display:none;animation:fade .24s ease}
.view.active{display:block}
.head{display:flex;align-items:center;gap:8px;margin-bottom:14px;padding:12px;background:var(--panel);border:1px solid var(--bd);border-radius:12px}
.back{appearance:none;border:0;background:none;color:var(--p1);font-size:18px;cursor:pointer}
.title{font-size:18px;font-weight:800}
.ai{background:linear-gradient(135deg,var(--p1),var(--p2));color:#000;padding:12px;border-radius:12px;margin-bottom:12px;position:relative;font-style:italic}
.ai:before{content:"ü§ñ";position:absolute;right:10px;top:-6px}
.panel{background:var(--panel);border:1px solid var(--bd);border-radius:12px;padding:12px;margin-bottom:12px}
.row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px;background:var(--panel2);border-radius:8px;margin-top:8px}
.in{width:100%;padding:8px;border-radius:8px;border:1px solid #333;color:#fff;background:rgba(255,255,255,.08)}
.subtle{font-size:11px;opacity:.7}

.badge{display:inline-block;background:rgba(255,255,255,.08);border:1px solid #333;border-radius:999px;padding:4px 8px;font-size:12px;margin-right:6px}

/* planner */
.slot{display:grid;grid-template-columns:64px 1fr;gap:8px;align-items:flex-start;margin:6px 0}
.slot .time{opacity:.8;font-size:12px;padding-top:6px}
.task{display:flex;gap:6px;align-items:center}
.task input[type="text"]{flex:1}
.task.done{opacity:.6;text-decoration:line-through}
.mini{font-size:12px;opacity:.85;margin-top:4px}

/* bottom nav */
.bottom{position:fixed;left:0;right:0;bottom:0;height:90px;background:linear-gradient(135deg,#111,#000);border-top:1px solid #222;display:flex;justify-content:center;align-items:center;padding-bottom:calc(env(safe-area-inset-bottom));z-index:10}
.homebtn{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px;background:linear-gradient(135deg,var(--p1),var(--p2));border:0;cursor:pointer}
.sys{position:absolute;right:20px;font-size:12px;color:var(--p1);background:rgba(255,182,193,.1);border:1px solid rgba(255,182,193,.35);padding:8px 12px;border-radius:12px;cursor:pointer}

/* jindi */
.jindi{position:fixed;right:18px;bottom:120px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,var(--p1),var(--p2));display:flex;align-items:center;justify-content:center;box-shadow:0 4px 18px rgba(255,182,193,.35);cursor:pointer;z-index:20;animation:wave 2s infinite}
.chat{position:fixed;right:18px;bottom:190px;width:300px;height:420px;display:none;z-index:25;background:rgba(0,0,0,.95);border:1px solid var(--p1);border-radius:15px;padding:12px;backdrop-filter:blur(10px)}
.chat.active{display:block;animation:up .22s ease}
.chathead{display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid #333}
.msgs{height:300px;overflow:auto;margin:10px 0}
.msg{max-width:80%;padding:8px 12px;border-radius:12px;margin-bottom:8px}
.msg.ai{background:linear-gradient(135deg,var(--p1),var(--p2));color:#000}
.msg.me{background:var(--panel2)}

/* canvases */
canvas{width:100%;height:120px;background:rgba(255,255,255,.04);border:1px solid #333;border-radius:8px}

/* doodle */
#doodle{height:200px;touch-action:none;cursor:crosshair}

@media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
@keyframes wave{0%,100%{transform:rotate(0)}25%{transform:rotate(12deg)}75%{transform:rotate(-12deg)}}
@keyframes up{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="logo">MINDflow</div>
    <div class="tag">Il tuo viaggio verso la consapevolezza</div>
  </div>

  <main id="main">
    <!-- HOME -->
    <div class="home-wrap view active" id="home" aria-label="Home">
      <section class="home">
        <button class="card career" data-view="career"><div class="ic">üß†</div><div class="tl">Carriera</div><div class="st">Mindset</div></button>
        <button class="card emo" data-view="emotions"><div class="ic">ü©∑</div><div class="tl">Emozioni</div><div class="st">Equilibrio</div></button>
        <button class="card fit" data-view="fitness"><div class="ic">üí™üèº</div><div class="tl">Fitness</div><div class="st">Alimentazione</div></button>
        <button class="card spi" data-view="spirituality"><div class="ic">üîÆ</div><div class="tl">Spiritualit√†</div><div class="st">Crescita</div></button>
        <button class="card com" data-view="community"><div class="ic">ü´Ç</div><div class="tl">Community</div><div class="st">Connessioni</div></button>
        <button class="card pro" data-view="profile"><div class="ic">ü´Ü</div><div class="tl">Profilo</div><div class="st">Il tuo universo</div></button>
      </section>
    </div>

    <!-- CARRIERA -->
    <section id="career" class="view" aria-label="Carriera">
      <div class="head"><button class="back" data-back>‚Üê</button><div class="title">üß† Carriera & Mindset</div></div>
      <div class="ai">"Oggi √® il giorno perfetto per trasformare i tuoi sogni in realt√†. Jindi crede in te!"</div>

      <!-- Priorit√† + obiettivi -->
      <div class="panel">
        <h3>‚ö†Ô∏è Priorit√† del giorno (max 3)</h3>
        <div id="prio-list"></div>
        <div class="row">
          <input id="prio-in" class="in" placeholder="Aggiungi priorit√†‚Ä¶" />
          <button id="prio-add" class="in" style="width:auto;cursor:pointer">+</button>
        </div>
      </div>
      <div class="panel">
        <h3>ü•á Obiettivo principale</h3>
        <input id="goal-main" class="in" placeholder="Scrivi l'obiettivo chiave della giornata">
        <div class="subtle">ü•à Mini obiettivi</div>
        <div id="goals-sub"></div>
        <div class="row">
          <input id="goal-sub-in" class="in" placeholder="Aggiungi mini obiettivo">
          <button id="goal-sub-add" class="in" style="width:auto;cursor:pointer">+</button>
        </div>
      </div>

      <!-- Daily Planner 24h -->
      <div class="panel">
        <h3>üìÖ Daily Planner (00:00 ‚Üí 23:30)</h3>
        <div id="planner"></div>
        <div class="subtle">Suggerimento: tocca la spunta per completare; la frase motivazionale appare sotto ogni task.</div>
      </div>

      <!-- Note / Meeting / altro -->
      <div class="panel"><h3>üóíÔ∏è Note rapide</h3><textarea id="quick-notes" class="in" rows="4" placeholder="Scrivi qui‚Ä¶"></textarea></div>
      <div class="panel"><h3>üíº Appuntamenti e meeting</h3>
        <div id="meetings"></div>
        <div class="row"><input id="meet-in" class="in" placeholder="Titolo + ora (es. 15:30 call‚Ä¶)"><button id="meet-add" class="in" style="width:auto">+</button></div>
      </div>
      <div class="panel"><h3>üì∏ Cosa ti ha colpito oggi?</h3>
        <textarea id="wow" class="in" rows="3" placeholder="Un‚Äôidea, un momento, un insight‚Ä¶"></textarea>
        <input id="wow-files" type="file" multiple class="in" />
      </div>
      <div class="panel"><h3>üß© Sfida personale</h3><input id="challenge" class="in" placeholder="Es. zero social per 1h"></div>

      <!-- Bilancio -->
      <div class="panel">
        <h3>üí∞ Bilancio giornaliero</h3>
        <div id="cash-rows"></div>
        <div class="row">
          <select id="cash-type" class="in" style="max-width:120px"><option>Entrata</option><option>Uscita</option></select>
          <input id="cash-desc" class="in" placeholder="Descrizione">
          <input id="cash-val" class="in" inputmode="decimal" placeholder="‚Ç¨">
          <button id="cash-add" class="in" style="width:auto">+</button>
        </div>
        <div class="row"><span>Totale Entrate</span><strong>‚Ç¨ <span id="cash-in">0.00</span></strong></div>
        <div class="row"><span>Totale Uscite</span><strong>‚Ç¨ <span id="cash-out">0.00</span></strong></div>
      </div>

      <div class="panel"><h3>ü§î Riflessione serale</h3><textarea id="reflection" class="in" rows="3" placeholder="Cosa ho imparato? Cosa migliorare?"></textarea></div>
      <div class="panel"><h3>üõçÔ∏è Lista cose da comprare</h3><div id="shop-list"></div><div class="row"><input id="shop-in" class="in" placeholder="Aggiungi‚Ä¶"><button id="shop-add" class="in" style="width:auto">+</button></div></div>
      <div class="panel"><h3>üßΩ Faccende domestiche</h3><div id="house-list"></div><div class="row"><input id="house-in" class="in" placeholder="Lavatrice, pulizie, ecc."><button id="house-add" class="in" style="width:auto">+</button></div></div>
      <div class="panel"><h3>üì≤ Email/Chiamate da fare</h3><div id="calls-list"></div><div class="row"><input id="calls-in" class="in" placeholder="Contatto/oggetto‚Ä¶"><button id="calls-add" class="in" style="width:auto">+</button></div></div>
      <div class="panel"><h3>‚è∞ Scadenze importanti</h3><div id="deadlines"></div><div class="row"><input id="dead-in" class="in" placeholder="Scadenza + data"><button id="dead-add" class="in" style="width:auto">+</button></div></div>

      <!-- Calcolo Rapido -->
      <div class="panel">
        <h3>üí∂ Calcolo Rapido</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
          <input id="hours" class="in" inputmode="decimal" placeholder="Ore" />
          <input id="rate" class="in" inputmode="decimal" placeholder="‚Ç¨/ora" />
          <div class="row"><span>Lordo</span><strong>‚Ç¨ <span id="gross">0.00</span></strong></div>
        </div>
      </div>
    </section>

    <!-- EMOZIONI -->
    <section id="emotions" class="view" aria-label="Emozioni">
      <div class="head"><button class="back" data-back>‚Üê</button><div class="title">ü©∑ Emozioni</div></div>
      <div class="ai">"Le tue emozioni sono valide. Navighiamo insieme questo mare interiore."</div>

      <div class="panel">
        <h3>üòä Tracker Umore</h3>
        <div class="row">
          <div class="badge">Ora</div>
          <input id="mood-time" type="time" class="in" style="max-width:140px">
        </div>
        <div style="display:flex;gap:8px;justify-content:space-between;margin:10px 0">
          <button class="card" style="width:auto;height:auto;padding:8px" data-mood="üò¢">üò¢</button>
          <button class="card" style="width:auto;height:auto;padding:8px" data-mood="üòê">üòê</button>
          <button class="card" style="width:auto;height:auto;padding:8px" data-mood="üòä">üòä</button>
          <button class="card" style="width:auto;height:auto;padding:8px" data-mood="üòÑ">üòÑ</button>
          <button class="card" style="width:auto;height:auto;padding:8px" data-mood="ü§©">ü§©</button>
        </div>
        <input id="intensity" type="range" min="1" max="10" value="7" style="width:100%">
        <p>Intensit√†: <strong><span id="intensity-val">7</span>/10</strong> ‚Äì Umore: <strong><span id="mood-val">üòä</span></strong></p>
        <div class="row"><input id="mood-save-note" class="in" placeholder="Nota/contesto‚Ä¶"><button id="mood-save" class="in" style="width:auto">Salva</button></div>
        <div class="row"><input id="mood-files" type="file" multiple class="in"></div>
      </div>

      <div class="panel">
        <h3>üìà Andamento</h3>
        <div class="badge">Giorno</div>
        <canvas id="chart-day"></canvas>
        <div class="badge" style="margin-top:8px">Settimana</div>
        <canvas id="chart-week"></canvas>
      </div>

      <div class="panel"><h3>‚ÅâÔ∏è Trigger emotivi</h3><input id="triggers" class="in" placeholder="Cosa ha cambiato l‚Äôumore?"></div>
      <div class="panel"><h3>üôèüèº Gratitudine</h3>
        <input class="in grat" placeholder="1‚Ä¶"><br/>
        <input class="in grat" placeholder="2‚Ä¶"><br/>
        <input class="in grat" placeholder="3‚Ä¶">
      </div>
      <div class="panel"><h3>üå™Ô∏è Contatti da ricordare</h3><div id="contacts"></div><div class="row"><input id="cont-in" class="in" placeholder="Nome o gruppo‚Ä¶"><button id="cont-add" class="in" style="width:auto">+</button></div><div class="subtle">Puoi allegare ricordi nelle note umore.</div></div>
      <div class="panel"><h3>‚ú® Self-care del giorno</h3><input id="selfcare" class="in" placeholder="Piccolo rituale personale‚Ä¶"></div>
    </section>

    <!-- FITNESS -->
    <section id="fitness" class="view" aria-label="Fitness e Alimentazione">
      <div class="head"><button class="back" data-back>‚Üê</button><div class="title">üí™üèº Fitness & Alimentazione</div></div>
      <div class="ai">"Il corpo √® il tempio dell‚Äôanima. Un passo alla volta!"</div>

      <div class="panel">
        <h3>üíß Contatori Giornalieri</h3>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <div class="panel" style="flex:1;min-width:140px">
            <div>üíß Idratazione</div>
            <div style="font-size:24px;font-weight:800;margin:8px 0" id="water-count">0</div>
            <div>
              <button data-counter="water" data-delta="-1">‚àí</button>
              <button data-counter="water" data-delta="1">+</button>
            </div>
            <div class="subtle">bicchieri</div>
          </div>
          <div class="panel" style="flex:1;min-width:140px">
            <div>üö≠ Sigarette</div>
            <div style="font-size:24px;font-weight:800;margin:8px 0" id="cig-count">0</div>
            <div>
              <button data-counter="cig" data-delta="-1">‚àí</button>
              <button data-counter="cig" data-delta="1">+</button>
            </div>
            <div class="subtle">oggi</div>
          </div>
          <div class="panel" style="flex:1;min-width:140px">
            <div>üç∑ Alcol</div>
            <div style="font-size:24px;font-weight:800;margin:8px 0" id="alc-count">0</div>
            <div>
              <button data-counter="alc" data-delta="-1">‚àí</button>
              <button data-counter="alc" data-delta="1">+</button>
            </div>
            <div class="subtle">unit√†</div>
          </div>
        </div>
      </div>

      <div class="panel">
        <h3>üò¥ Sonno / üßò Stretching / üíä Integratori</h3>
        <div class="row"><span>Ore di sonno</span><input id="sleep" class="in" style="max-width:100px" inputmode="decimal" placeholder="7.5"></div>
        <div class="row"><span>Stretching/Yoga</span><input id="yoga" class="in" placeholder="Es. 15‚Äô allungo‚Ä¶"></div>
        <div class="row"><span>Farmaci/Integratori</span><input id="meds" class="in" placeholder="Vit. D, Magnesio‚Ä¶"></div>
      </div>

      <!-- Nutrizione -->
      <div class="panel">
        <h3>üçΩÔ∏è Nutrizione (kcal)</h3>
        <div id="diet"></div>
        <div class="row"><input id="diet-name" class="in" placeholder="Piatto (es. yogurt)"><input id="diet-kcal" class="in" inputmode="decimal" placeholder="kcal"><button id="diet-add" class="in" style="width:auto">+</button></div>
        <div class="row"><span>Totale oggi</span><strong><span id="kcal">0</span> kcal</strong></div>
      </div>

      <!-- Spesa + Ricette AI -->
      <div class="panel">
        <h3>üõí Spesa & Ricette (AI)</h3>
        <input id="ing" class="in" placeholder="Scrivi ingredienti o incolla la lista (es. uova, cipolle)‚Ä¶"/>
        <div class="row">
          <input id="spesa-foto" type="file" class="in" style="max-width:55%">
          <button id="ricette-ai" class="in" style="width:auto">Suggerisci ricette (AI)</button>
        </div>
        <textarea id="ricette-out" class="in" rows="5" placeholder="Risultato‚Ä¶"></textarea>
        <div class="subtle">L‚ÄôOCR delle foto non √® attivo qui: l‚ÄôAI user√† solo il testo degli ingredienti.</div>
      </div>

      <!-- Workout AI -->
      <div class="panel">
        <h3>üèãÔ∏è Workout (AI)</h3>
        <div class="row">
          <input id="wo-goal" class="in" placeholder="Obiettivo (es. Forza)">
          <input id="wo-days" class="in" placeholder="Giorni/settimana (es. 3)" style="max-width:160px">
          <button id="wo-genera" class="in" style="width:auto">Genera piano</button>
        </div>
        <textarea id="wo-out" class="in" rows="6" placeholder="Il piano apparir√† qui‚Ä¶"></textarea>
      </div>
    </section>

    <!-- SPIRITUALIT√Ä -->
    <section id="spirituality" class="view" aria-label="Spiritualit√†">
      <div class="head"><button class="back" data-back>‚Üê</button><div class="title">üîÆ Spiritualit√†</div></div>
      <div class="ai" style="background:linear-gradient(135deg,var(--p3),var(--p1))">"Le stelle ti sussurrano: oggi √® giorno di trasformazione."</div>

      <div class="panel" style="text-align:center">
        <h3>üßò‚Äç‚ôÄÔ∏è Meditazione Guidata</h3>
        <div id="med-timer" style="font-size:32px;font-weight:800;color:var(--p1);margin:8px 0">05:00</div>
        <button id="med-toggle" class="in" style="cursor:pointer;width:auto">‚ñ∂Ô∏è Avvia/Metti in pausa</button>
      </div>

      <div class="panel">
        <h3>ü™ê Tema natale (AI)</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="astro-date" class="in" type="date" />
          <input id="astro-time" class="in" type="time" />
        </div>
        <input id="astro-place" class="in" placeholder="Citt√†, provincia">
        <button id="astro-analyze" class="in" style="width:auto;margin-top:8px">Analizza influenza su azioni & umore</button>
        <textarea id="astro-out" class="in" rows="5" placeholder="Risultato‚Ä¶"></textarea>
        <div class="subtle">Per un calcolo astronomico preciso servono effemeridi/servizi esterni; qui l‚ÄôAI crea una lettura personalizzata.</div>
      </div>

      <div class="panel"><h3>üÉè Carte del giorno</h3><button id="tarot" class="in" style="width:auto">Pesca</button> <span id="tarot-out" class="badge"></span></div>
      <div class="panel"><h3>üïØÔ∏è Rituale personale</h3><input id="ritual" class="in" placeholder="Candela, journaling‚Ä¶"></div>
      <div class="panel"><h3>üìø Sogni ricordati</h3><textarea id="dreams" class="in" rows="3"></textarea></div>
      <div class="panel"><h3>üé® Doodle</h3><canvas id="doodle"></canvas><div class="row"><button id="doodle-clear" class="in" style="width:auto">Pulisci</button><button id="doodle-save" class="in" style="width:auto">Salva PNG</button></div></div>
      <div class="panel"><h3>üé∂ Playlist del giorno</h3><input id="playlist" class="in" placeholder="Incolla link Spotify/YouTube‚Ä¶"></div>
      <div class="panel"><h3>üéûÔ∏è Film/Libri/Serie</h3><div id="media-list"></div><div class="row"><input id="media-in" class="in" placeholder="Titolo‚Ä¶"><button id="media-add" class="in" style="width:auto">+</button></div></div>
      <div class="panel"><h3>üñåÔ∏è Ispirazione creativa</h3><input id="spark" class="in" placeholder="Idea, frase, sketch‚Ä¶"></div>
    </section>

    <!-- COMMUNITY -->
    <section id="community" class="view" aria-label="Community">
      <div class="head"><button class="back" data-back>‚Üê</button><div class="title">ü´Ç Community</div></div>
      <div class="ai">"Insieme siamo pi√π forti!"</div>
      <div class="panel">
        <h3>‚ú® Condividi il tuo momento</h3>
        <textarea rows="3" class="in" id="post-text" placeholder="Cosa stai pensando oggi?"></textarea>
        <div class="row">
          <span>Allega üì∑ üéØ üí°</span>
          <button id="post-btn" class="in" style="width:auto;cursor:pointer">Pubblica</button>
        </div>
      </div>
      <div class="panel" id="feed">
        <h3>üì∞ Feed</h3>
        <div class="row"><span>@MindfulSara</span><span>‚ÄúPrima meditazione di 20‚Äô fatta! üßò‚Äç‚ôÄÔ∏è‚Äù</span></div>
        <div class="row"><span>@FitnessMarco</span><span>‚Äú10.000 passi al giorno ‚úÖ‚Äù</span></div>
      </div>
    </section>

    <!-- PROFILO -->
    <section id="profile" class="view" aria-label="Profilo">
      <div class="head"><button class="back" data-back>‚Üê</button><div class="title">ü´Ü Profilo</div></div>
      <div class="ai">"Il tuo profilo √® la mappa del tuo universo."</div>

      <div class="panel">
        <h3>üë§ Info</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input class="in" value="Alessandro" placeholder="Nome">
          <input class="in" value="Rossi" placeholder="Cognome">
          <input class="in" value="alex@mindflow.app" placeholder="Email">
          <input class="in" type="date" value="1995-03-15">
        </div>
      </div>

      <div class="panel">
        <h3>üîî Notifiche</h3>
        <label style="display:flex;align-items:center;gap:8px;margin:6px 0"><input type="checkbox" checked> üß† Carriera</label>
        <label style="display:flex;align-items:center;gap:8px;margin:6px 0"><input type="checkbox"> ü©∑ Emozioni</label>
        <label style="display:flex;align-items:center;gap:8px;margin:6px 0"><input type="checkbox" checked> üí™üèº Fitness</label>
        <label style="display:flex;align-items:center;gap:8px;margin:6px 0"><input type="checkbox" checked> üîÆ Spiritualit√†</label>
      </div>

      <div class="panel">
        <h3>üíé Piani & Upgrade</h3>
        <div class="row"><span>üå∏ Boccioli (7,99‚Ç¨/mese)</span><a class="in" style="width:auto;text-decoration:none;text-align:center" href="https://buy.stripe.com/cNicN53Lp5WW46y6Y1d0Q03" target="_blank">Abbonati</a></div>
        <div class="row"><span>üå∑ Fiori (12,99‚Ç¨/mese)</span><a class="in" style="width:auto;text-decoration:none;text-align:center" href="https://buy.stripe.com/5kQeVd6XBCLj8W05TXd0Q04" target="_blank">Abbonati</a></div>
        <div class="row"><span>üå∫ Premium (149,99‚Ç¨/mese)</span><a class="in" style="width:auto;text-decoration:none;text-align:center" href="https://buy.stripe.com/00w7sL3Lpclj3Cucild0Q05" target="_blank">Abbonati</a></div>
        <div class="subtle">Se un link desse errore, verifica su Stripe che il Payment Link sia pubblicato e non archiviato.</div>
      </div>
    </section>
  </main>

  <nav class="bottom" aria-label="Navigazione">
    <button class="homebtn" id="go-home" aria-label="Home">üè†</button>
    <button class="sys" id="open-system" aria-haspopup="dialog">Sistema ‚öôÔ∏è</button>
  </nav>
</div>

<!-- Bolla Jindi -->
<button class="jindi" id="jindi" aria-controls="chat" aria-expanded="false">üëã</button>

<!-- Chat -->
<section class="chat" id="chat" aria-live="polite" aria-label="Chat con Jindi">
  <div class="chathead">
    <div style="width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--p1),var(--p2));display:flex;align-items:center;justify-content:center">üëã</div>
    <div><strong>Jindi AI</strong><div style="font-size:10px;opacity:.7">Il tuo assistente</div></div>
    <button id="close-chat" style="margin-left:auto;background:none;border:0;color:#ccc;font-size:18px">√ó</button>
  </div>
  <div class="msgs" id="msgs"><div class="msg ai">Ciao! Come posso aiutarti oggi? üåü</div></div>
  <input id="chat-in" class="in" placeholder="Scrivi a Jindi‚Ä¶" />
</section>

<script>
/* helpers */
const $ = (s, r=document)=>r.querySelector(s);
const $$ = (s, r=document)=>[...r.querySelectorAll(s)];
const persist = (k,v)=>localStorage.setItem(k, JSON.stringify(v));
const read = (k,d=null)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? d }catch{ return d } };

/* router */
const views = ["home","career","emotions","fitness","spirituality","community","profile"];
function show(v){ views.forEach(x=>$("#"+x).classList.toggle("active", x===v)); location.hash="#"+v; }
window.addEventListener("hashchange", ()=>{ const v=(location.hash||"#home").slice(1); show(views.includes(v)?v:"home"); });
$("#go-home").addEventListener("click", ()=>show("home"));
$$("#home .card").forEach(b=>b.addEventListener("click", ()=>show(b.dataset.view)));
$$("[data-back]").forEach(b=>b.addEventListener("click", ()=>history.back()));
$("#open-system").addEventListener("click", ()=>alert("Impostazioni, Backup, Supporto, Info App"));

/* CHAT */
const bubble=$("#jindi"), chat=$("#chat"), closeChat=$("#close-chat"), chatIn=$("#chat-in"), msgs=$("#msgs");
function toggleChat(open){ const isOpen=open??!chat.classList.contains("active"); chat.classList.toggle("active", isOpen); bubble.setAttribute("aria-expanded", String(isOpen)); if(isOpen) chatIn.focus(); }
bubble.addEventListener("click", ()=>toggleChat()); closeChat.addEventListener("click", ()=>toggleChat(false));
function addMsg(text, who="ai"){ const d=document.createElement("div"); d.className="msg "+who; d.textContent=text; msgs.appendChild(d); msgs.scrollTop=msgs.scrollHeight; }
async function ai(endpoint, payload){
  try{
    const r = await fetch(endpoint, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload) });
    if(!r.ok) throw new Error(await r.text());
    const j = await r.json();
    return j.reply || j.text || j.result || "Fatto ‚ú®";
  }catch(e){ console.error(e); return "Ops, non riesco ora üôè"; }
}
chatIn.addEventListener("keydown", async e=>{
  if(e.key==="Enter"){
    const text=chatIn.value.trim(); if(!text) return;
    addMsg(text,"me"); chatIn.value="";
    const reply = await ai("/api/chat",{ message:text });
    addMsg(reply,"ai");
  }
});

/* CAREER ‚Äî priorit√†, goals */
const prioList=$("#prio-list"), prioIn=$("#prio-in");
$("#prio-add").addEventListener("click", ()=>{
  const t=prioIn.value.trim(); if(!t) return;
  const items=[...prioList.querySelectorAll(".row")].length; if(items>=3){ alert("Massimo 3 priorit√†"); return; }
  addCheckRow(prioList,t,"prio");
  prioIn.value="";
  saveBlock("prio", prioList);
});
function addCheckRow(container, text, ns){
  const row=document.createElement("div"); row.className="row";
  row.innerHTML=`<label style="display:flex;align-items:center;gap:8px;width:100%"><input type="checkbox" class="${ns}-chk"> <input class="in ${ns}-txt" value="${text}"></label><button class="in" style="width:auto">‚úï</button>`;
  row.querySelector("button").onclick=()=>{ row.remove(); saveBlock(ns, container); };
  container.appendChild(row);
}
function saveBlock(ns, container){
  const data=[...container.querySelectorAll("label")].map(l=>({ done:l.querySelector("input[type=checkbox]").checked, text:l.querySelector(".in").value }));
  persist("mf_"+ns, data);
}
function loadBlock(ns, container){ (read("mf_"+ns,[])||[]).forEach(i=>{ addCheckRow(container,i.text,ns); const last=container.lastElementChild; last.querySelector("input[type=checkbox]").checked=i.done; }); }

/* Goals */
$("#goal-sub-add").addEventListener("click", ()=>{
  const t=$("#goal-sub-in").value.trim(); if(!t) return;
  addCheckRow($("#goals-sub"), t, "goalsub"); $("#goal-sub-in").value="";
  saveBlock("goalsub", $("#goals-sub"));
});
$("#goal-main").addEventListener("input",()=>persist("mf_goal_main", $("#goal-main").value));

/* Planner 24h */
const planner=$("#planner");
function buildPlanner(){
  planner.innerHTML="";
  for(let h=0; h<24; h++){
    for(let m=0; m<60; m+=30){
      const key = `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
      const wrap=document.createElement("div"); wrap.className="slot";
      wrap.innerHTML=`
        <div class="time">${key}</div>
        <div class="task">
          <input class="in t-${key}" placeholder="Aggiungi attivit√† per ${key}">
          <button class="in" style="width:auto">‚úÖ</button>
        </div>
        <div class="mini" id="mot-${key}"></div>
      `;
      const input=wrap.querySelector("input");
      const btn=wrap.querySelector("button");
      input.value = (read("mf_planner",{})[key]?.text)||"";
      if(read("mf_planner",{})[key]?.done){ wrap.querySelector(".task").classList.add("done"); }
      btn.onclick=async ()=>{
        const done=wrap.querySelector(".task").classList.toggle("done");
        const all = read("mf_planner", {});
        all[key]={ text: input.value, done };
        persist("mf_planner", all);
        if(input.value && done){
          $("#mot-"+key).textContent = "‚Ä¶";
          const phrase = await ai("/api/chat", { message: `Scrivi una frase motivazionale corta (max 12 parole) per l'azione: "${input.value}". Tono: empatico, energizzante. Italiano.` });
          $("#mot-"+key).textContent = "‚ú® " + phrase;
        }
      };
      input.addEventListener("change", ()=>{
        const all = read("mf_planner",{});
        all[key] = { text: input.value, done: wrap.querySelector(".task").classList.contains("done") };
        persist("mf_planner", all);
      });
      planner.appendChild(wrap);
    }
  }
}

/* Meetings, lists, cash, ecc. (generatori generici) */
function simpleList(ns, containerId, inputId, addBtnId){
  const container=$(containerId), inp=$(inputId), add=$(addBtnId);
  function addRow(text){ const r=document.createElement("div"); r.className="row"; r.innerHTML=`<span>${text}</span><button class="in" style="width:auto">‚úï</button>`; r.querySelector("button").onclick=()=>{ r.remove(); save(); }; container.appendChild(r); }
  function save(){ persist("mf_"+ns, [...container.querySelectorAll(".row span")].map(s=>s.textContent)); }
  (read("mf_"+ns,[])||[]).forEach(addRow);
  add.onclick=()=>{ const t=inp.value.trim(); if(!t) return; addRow(t); inp.value=""; save(); };
}
simpleList("meet","#meetings","#meet-in","#meet-add");
simpleList("shop","#shop-list","#shop-in","#shop-add");
simpleList("house","#house-list","#house-in","#house-add");
simpleList("calls","#calls-list","#calls-in","#calls-add");
simpleList("media","#media-list","#media-in","#media-add");
simpleList("dead","#deadlines","#dead-in","#dead-add");

/* Cash book */
function refreshCash(){
  const items = read("mf_cash",[]);
  let inc=0,out=0;
  $("#cash-rows").innerHTML="";
  items.forEach((it,i)=>{
    const r=document.createElement("div"); r.className="row";
    r.innerHTML=`<span>${it.type} ‚Äî ${it.desc}</span><strong>‚Ç¨ ${Number(it.val||0).toFixed(2)}</strong><button class="in" style="width:auto">‚úï</button>`;
    r.querySelector("button").onclick=()=>{ items.splice(i,1); persist("mf_cash",items); refreshCash(); };
    $("#cash-rows").appendChild(r);
    if(it.type==="Entrata") inc+=Number(it.val||0); else out+=Number(it.val||0);
  });
  $("#cash-in").textContent=inc.toFixed(2); $("#cash-out").textContent=out.toFixed(2);
}
$("#cash-add").onclick=()=>{
  const it={ type:$("#cash-type").value, desc:$("#cash-desc").value.trim(), val:parseFloat($("#cash-val").value||0) };
  if(!it.desc) return;
  const arr=read("mf_cash",[]); arr.push(it); persist("mf_cash",arr); $("#cash-desc").value=""; $("#cash-val").value=""; refreshCash();
};

/* Quick notes, challenge, reflection, goal main */
["quick-notes","challenge","reflection","goal-main","triggers","selfcare","sleep","yoga","meds","ritual","dreams","playlist","spark","astro-place"].forEach(id=>{
  const el=$("#"+id); if(!el) return; el.value=read("mf_"+id,""); el.addEventListener("input",()=>persist("mf_"+id,el.value));
});
loadBlock("prio", prioList);
loadBlock("goalsub", $("#goals-sub"));

/* Calc rapido */
const hours=$("#hours"), rate=$("#rate"), gross=$("#gross");
function calc(){ const h=parseFloat(hours?.value||0)||0; const r=parseFloat(rate?.value||0)||0; const g=h*r; gross.textContent=g.toFixed(2); }
hours?.addEventListener("input", calc); rate?.addEventListener("input", calc);

/* Planner build */
buildPlanner();

/* EMOZIONI ‚Äî tracker + grafici */
let currentMood="üòä";
$$("[data-mood]").forEach(btn=>btn.addEventListener("click", ()=>{ currentMood=btn.dataset.mood; $("#mood-val").textContent=currentMood; }));
$("#intensity").addEventListener("input", e=>$("#intensity-val").textContent=e.target.value);
$("#mood-save").onclick=()=>{
  const log=read("mf_mood",[]);
  log.push({ t: $("#mood-time").value || new Date().toTimeString().slice(0,5), mood: currentMood, inten: Number($("#intensity").value), note: $("#mood-save-note").value });
  persist("mf_mood", log);
  drawCharts();
  $("#mood-save-note").value="";
};
function drawLine(canvas, points){
  const ctx=canvas.getContext("2d"); const W=canvas.width=canvas.clientWidth, H=canvas.height=canvas.clientHeight;
  ctx.clearRect(0,0,W,H); ctx.strokeStyle="#fff"; ctx.lineWidth=2; ctx.beginPath();
  points.forEach((p,i)=>{ const x=i*(W/Math.max(points.length-1,1)); const y=H - (p/10)*H; if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
  ctx.stroke();
}
function drawCharts(){
  const data=read("mf_mood",[]);
  const today=new Date().toDateString();
  const day=data.filter(x=> (new Date().toDateString())===today).map(x=>x.inten);
  const week=data.slice(-14).map(x=>x.inten); // ultimi log
  drawLine($("#chart-day"), day.length?day:[0]);
  drawLine($("#chart-week"), week.length?week:[0]);
}
drawCharts();

/* FITNESS counters + diet */
const counters={water:$("#water-count"), cig:$("#cig-count"), alc:$("#alc-count")};
Object.keys(counters).forEach(k=>{ counters[k].textContent=read("mf_cnt_"+k,0); });
$$("[data-counter]").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const n=btn.dataset.counter; const d=parseInt(btn.dataset.delta,10);
    let v=parseInt(counters[n].textContent||"0",10)+d; v=Math.max(0,v);
    counters[n].textContent=v; persist("mf_cnt_"+n,v);
  });
});
const dietOut=$("#diet"), kcal=$("#kcal");
function refreshDiet(){
  const items=read("mf_diet",[]);
  dietOut.innerHTML=""; let tot=0;
  items.forEach((it,i)=>{ const r=document.createElement("div"); r.className="row"; r.innerHTML=`<span>${it.name}</span><strong>${it.kcal} kcal</strong><button class="in" style="width:auto">‚úï</button>`; r.querySelector("button").onclick=()=>{ items.splice(i,1); persist("mf_diet",items); refreshDiet(); }; dietOut.appendChild(r); tot+=Number(it.kcal||0); });
  kcal.textContent=tot;
}
$("#diet-add").onclick=()=>{ const it={ name:$("#diet-name").value.trim(), kcal:parseInt($("#diet-kcal").value||0,10) }; if(!it.name) return; const arr=read("mf_diet",[]); arr.push(it); persist("mf_diet",arr); $("#diet-name").value=""; $("#diet-kcal").value=""; refreshDiet(); };
refreshDiet();

/* Ricette AI + Workout AI */
$("#ricette-ai").onclick=async()=>{ $("#ricette-out").value="‚Ä¶"; $("#ricette-out").value = await ai("/api/recipes", { ingredients: $("#ing").value || "uova, cipolle" }); };
$("#wo-genera").onclick=async()=>{ $("#wo-out").value="‚Ä¶"; $("#wo-out").value = await ai("/api/workout", { goal: $("#wo-goal").value || "Forza", days: $("#wo-days").value || "3" }); };

/* SPIRIT ‚Äî meditation timer */
const medBtn=$("#med-toggle"), medTimer=$("#med-timer"); let secs=5*60, iv=null;
function rend(){const m=Math.floor(secs/60), s=secs%60; medTimer.textContent=String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");}
function start(){ if(iv) return; iv=setInterval(()=>{ if(secs>0){secs--;rend();}else{stop();secs=5*60;rend();alert("Meditazione completata ‚ú®");}},1000); }
function stop(){ clearInterval(iv); iv=null; }
medBtn?.addEventListener("click", ()=> iv?stop():start()); rend();

/* Tema natale (AI) */
$("#astro-analyze").onclick=async()=>{
  $("#astro-out").value="‚Ä¶";
  const date=$("#astro-date").value, time=$("#astro-time").value, place=$("#astro-place").value;
  $("#astro-out").value = await ai("/api/astro", { date, time, place });
};

/* Tarot */
const TAROT=["Il Matto","Il Mago","La Sacerdotessa","L'Imperatrice","L'Imperatore","Il Papa","Gli Amanti","Il Carro","La Giustizia","L'Eremita","Ruota della Fortuna","La Forza","L'Appeso","La Morte","Temperanza","Il Diavolo","La Torre","La Stella","La Luna","Il Sole","Il Giudizio","Il Mondo"];
$("#tarot").onclick=()=>{ $("#tarot-out").textContent = TAROT[Math.floor(Math.random()*TAROT.length)]; };

/* Doodle */
const doodle=$("#doodle"); const dctx=doodle.getContext("2d"); let drawing=false, last=null;
function resizeD(){ doodle.width=doodle.clientWidth; doodle.height=doodle.clientHeight; } resizeD(); window.addEventListener("resize",resizeD);
function pos(e){ const r=doodle.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left; const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top; return {x,y}; }
function drawTo(p){ if(!last){ last=p; return; } dctx.strokeStyle="#fff"; dctx.lineWidth=2; dctx.beginPath(); dctx.moveTo(last.x,last.y); dctx.lineTo(p.x,p.y); dctx.stroke(); last=p; }
doodle.addEventListener("pointerdown",e=>{ drawing=true; last=pos(e); });
doodle.addEventListener("pointermove",e=>{ if(drawing) drawTo(pos(e)); });
doodle.addEventListener("pointerup",()=>{ drawing=false; last=null; });
$("#doodle-clear").onclick=()=>{ dctx.clearRect(0,0,doodle.width,doodle.height); };
$("#doodle-save").onclick=()=>{ const a=document.createElement("a"); a.href=doodle.toDataURL("image/png"); a.download="doodle.png"; a.click(); };

/* Community */
$("#post-btn")?.addEventListener("click", ()=>{
  const t=$("#post-text").value.trim(); if(!t) return;
  const row=document.createElement("div"); row.className="row";
  row.innerHTML=`<span>@Tu</span><span>${t}</span>`;
  $("#feed").appendChild(row); $("#post-text").value="";
  alert("Pubblicato nella community ‚ú®");
});

/* START */
show((location.hash||"#home").slice(1));
</script>
</body>
</html>
